<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestor de contenido</title>
    <!-- Include the script that enables Netlify Identity on this page. -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body>
    <!-- Include the script that builds the page and powers Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    <script>
        var IdControl = createClass({

            getInitialState() {
                return {
                    value: "",
                    uniq: ""
                };
            },

            componentDidMount() {
                function uniq() {
                    return Math.random().toString(36).substr(2, 9);
                };

                this.setState((state) => {
                    return {
                        uniq: uniq()
                    }
                })

                const nameInput = document.getElementById('name-field-1');

                if (nameInput) {
                    if (nameInput.value.length) {
                        this.setState((state) => {
                            return {
                                value: nameInput.value.substring(0, 3).toUpperCase()
                            }
                        })
                    }

                    nameInput.addEventListener('keydown', (event) => {
                        this.setState((state) => {
                            return {
                                value: event.target.value.substring(0, 3).toUpperCase()
                            }
                        })
                    });
                }


            },

            render: function () {
                return h('input', {
                    id: this.props.forID,
                    className: this.props.classNameWrapper,
                    type: 'text',
                    readOnly: true,
                    required: false,
                    value: this.state.value + '-' + this.state.uniq,
                });
            },
        });

        var IdPreview = createClass({
            render: function () {
                return h('ul', {},
                    this.props.value.map(function (val, index) {
                        return h('li', { key: index }, val);
                    })
                );
            }
        });

        var schema = {
            properties: {
                separator: { type: 'string' },
            },
        }

        CMS.registerWidget('id', IdControl, IdPreview, schema);
    </script>
</body>

</html>